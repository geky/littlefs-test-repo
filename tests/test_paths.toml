
# simple path test
[cases.test_paths_normal]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg) => 0;
    lfs2_mount(&lfs2, cfg) => 0;
    lfs2_mkdir(&lfs2, "tea") => 0;
    lfs2_mkdir(&lfs2, "tea/hottea") => 0;
    lfs2_mkdir(&lfs2, "tea/warmtea") => 0;
    lfs2_mkdir(&lfs2, "tea/coldtea") => 0;

    struct lfs2_info info;
    lfs2_stat(&lfs2, "tea/hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);
    lfs2_stat(&lfs2, "/tea/hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);

    lfs2_mkdir(&lfs2, "/milk") => 0;
    lfs2_stat(&lfs2, "/milk", &info) => 0;
    assert(strcmp(info.name, "milk") == 0);
    lfs2_stat(&lfs2, "milk", &info) => 0;
    assert(strcmp(info.name, "milk") == 0);
    lfs2_unmount(&lfs2) => 0;
'''

# redundant slashes
[cases.test_paths_redundant_slashes]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg) => 0;
    lfs2_mount(&lfs2, cfg) => 0;
    lfs2_mkdir(&lfs2, "tea") => 0;
    lfs2_mkdir(&lfs2, "tea/hottea") => 0;
    lfs2_mkdir(&lfs2, "tea/warmtea") => 0;
    lfs2_mkdir(&lfs2, "tea/coldtea") => 0;

    struct lfs2_info info;
    lfs2_stat(&lfs2, "/tea/hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);
    lfs2_stat(&lfs2, "//tea//hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);
    lfs2_stat(&lfs2, "///tea///hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);

    lfs2_mkdir(&lfs2, "////milk") => 0;
    lfs2_stat(&lfs2, "////milk", &info) => 0;
    assert(strcmp(info.name, "milk") == 0);
    lfs2_stat(&lfs2, "milk", &info) => 0;
    assert(strcmp(info.name, "milk") == 0);
    lfs2_unmount(&lfs2) => 0;
'''

# dot path test
[cases.test_paths_dot]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg) => 0;
    lfs2_mount(&lfs2, cfg) => 0;
    lfs2_mkdir(&lfs2, "tea") => 0;
    lfs2_mkdir(&lfs2, "tea/hottea") => 0;
    lfs2_mkdir(&lfs2, "tea/warmtea") => 0;
    lfs2_mkdir(&lfs2, "tea/coldtea") => 0;

    struct lfs2_info info;
    lfs2_stat(&lfs2, "./tea/hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);
    lfs2_stat(&lfs2, "/./tea/hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);
    lfs2_stat(&lfs2, "/././tea/hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);
    lfs2_stat(&lfs2, "/./tea/./hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);

    lfs2_mkdir(&lfs2, "/./milk") => 0;
    lfs2_stat(&lfs2, "/./milk", &info) => 0;
    assert(strcmp(info.name, "milk") == 0);
    lfs2_stat(&lfs2, "milk", &info) => 0;
    assert(strcmp(info.name, "milk") == 0);
    lfs2_unmount(&lfs2) => 0;
'''

# dot dot path test
[cases.test_paths_dot_dot]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg) => 0;
    lfs2_mount(&lfs2, cfg) => 0;
    lfs2_mkdir(&lfs2, "tea") => 0;
    lfs2_mkdir(&lfs2, "tea/hottea") => 0;
    lfs2_mkdir(&lfs2, "tea/warmtea") => 0;
    lfs2_mkdir(&lfs2, "tea/coldtea") => 0;
    lfs2_mkdir(&lfs2, "coffee") => 0;
    lfs2_mkdir(&lfs2, "coffee/hotcoffee") => 0;
    lfs2_mkdir(&lfs2, "coffee/warmcoffee") => 0;
    lfs2_mkdir(&lfs2, "coffee/coldcoffee") => 0;

    struct lfs2_info info;
    lfs2_stat(&lfs2, "coffee/../tea/hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);
    lfs2_stat(&lfs2, "tea/coldtea/../hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);
    lfs2_stat(&lfs2, "coffee/coldcoffee/../../tea/hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);
    lfs2_stat(&lfs2, "coffee/../coffee/../tea/hottea", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);

    lfs2_mkdir(&lfs2, "coffee/../milk") => 0;
    lfs2_stat(&lfs2, "coffee/../milk", &info) => 0;
    strcmp(info.name, "milk") => 0;
    lfs2_stat(&lfs2, "milk", &info) => 0;
    strcmp(info.name, "milk") => 0;
    lfs2_unmount(&lfs2) => 0;
'''

# trailing dot path test
[cases.test_paths_trailing_dot]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg) => 0;
    lfs2_mount(&lfs2, cfg) => 0;
    lfs2_mkdir(&lfs2, "tea") => 0;
    lfs2_mkdir(&lfs2, "tea/hottea") => 0;
    lfs2_mkdir(&lfs2, "tea/warmtea") => 0;
    lfs2_mkdir(&lfs2, "tea/coldtea") => 0;

    struct lfs2_info info;
    lfs2_stat(&lfs2, "tea/hottea/", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);
    lfs2_stat(&lfs2, "tea/hottea/.", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);
    lfs2_stat(&lfs2, "tea/hottea/./.", &info) => 0;
    assert(strcmp(info.name, "hottea") == 0);
    lfs2_stat(&lfs2, "tea/hottea/..", &info) => 0;
    assert(strcmp(info.name, "tea") == 0);
    lfs2_stat(&lfs2, "tea/hottea/../.", &info) => 0;
    assert(strcmp(info.name, "tea") == 0);
    lfs2_unmount(&lfs2) => 0;
'''

# leading dot path test
[cases.test_paths_leading_dot]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg) => 0;
    lfs2_mount(&lfs2, cfg) => 0;
    lfs2_mkdir(&lfs2, ".milk") => 0;
    struct lfs2_info info;
    lfs2_stat(&lfs2, ".milk", &info) => 0;
    strcmp(info.name, ".milk") => 0;
    lfs2_stat(&lfs2, "tea/.././.milk", &info) => 0;
    strcmp(info.name, ".milk") => 0;
    lfs2_unmount(&lfs2) => 0;
'''

# root dot dot path test
[cases.test_paths_root_dot_dot]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg) => 0;
    lfs2_mount(&lfs2, cfg) => 0;
    lfs2_mkdir(&lfs2, "tea") => 0;
    lfs2_mkdir(&lfs2, "tea/hottea") => 0;
    lfs2_mkdir(&lfs2, "tea/warmtea") => 0;
    lfs2_mkdir(&lfs2, "tea/coldtea") => 0;
    lfs2_mkdir(&lfs2, "coffee") => 0;
    lfs2_mkdir(&lfs2, "coffee/hotcoffee") => 0;
    lfs2_mkdir(&lfs2, "coffee/warmcoffee") => 0;
    lfs2_mkdir(&lfs2, "coffee/coldcoffee") => 0;

    struct lfs2_info info;
    lfs2_stat(&lfs2, "coffee/../../../../../../tea/hottea", &info) => 0;
    strcmp(info.name, "hottea") => 0;

    lfs2_mkdir(&lfs2, "coffee/../../../../../../milk") => 0;
    lfs2_stat(&lfs2, "coffee/../../../../../../milk", &info) => 0;
    strcmp(info.name, "milk") => 0;
    lfs2_stat(&lfs2, "milk", &info) => 0;
    strcmp(info.name, "milk") => 0;
    lfs2_unmount(&lfs2) => 0;
'''

# invalid path tests
[cases.test_paths_invalid]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg);
    lfs2_mount(&lfs2, cfg) => 0;
    struct lfs2_info info;
    lfs2_stat(&lfs2, "dirt", &info) => LFS2_ERR_NOENT;
    lfs2_stat(&lfs2, "dirt/ground", &info) => LFS2_ERR_NOENT;
    lfs2_stat(&lfs2, "dirt/ground/earth", &info) => LFS2_ERR_NOENT;

    lfs2_remove(&lfs2, "dirt") => LFS2_ERR_NOENT;
    lfs2_remove(&lfs2, "dirt/ground") => LFS2_ERR_NOENT;
    lfs2_remove(&lfs2, "dirt/ground/earth") => LFS2_ERR_NOENT;

    lfs2_mkdir(&lfs2, "dirt/ground") => LFS2_ERR_NOENT;
    lfs2_file_t file;
    lfs2_file_open(&lfs2, &file, "dirt/ground", LFS2_O_WRONLY | LFS2_O_CREAT)
            => LFS2_ERR_NOENT;
    lfs2_mkdir(&lfs2, "dirt/ground/earth") => LFS2_ERR_NOENT;
    lfs2_file_open(&lfs2, &file, "dirt/ground/earth", LFS2_O_WRONLY | LFS2_O_CREAT)
            => LFS2_ERR_NOENT;
    lfs2_unmount(&lfs2) => 0;
'''

# root operations
[cases.test_paths_root]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg) => 0;
    lfs2_mount(&lfs2, cfg) => 0;
    struct lfs2_info info;
    lfs2_stat(&lfs2, "/", &info) => 0;
    assert(strcmp(info.name, "/") == 0);
    assert(info.type == LFS2_TYPE_DIR);

    lfs2_mkdir(&lfs2, "/") => LFS2_ERR_EXIST;
    lfs2_file_t file;
    lfs2_file_open(&lfs2, &file, "/", LFS2_O_WRONLY | LFS2_O_CREAT)
            => LFS2_ERR_ISDIR;

    lfs2_remove(&lfs2, "/") => LFS2_ERR_INVAL;
    lfs2_unmount(&lfs2) => 0;
'''

# root representations
[cases.test_paths_root_reprs]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg) => 0;
    lfs2_mount(&lfs2, cfg) => 0;
    struct lfs2_info info;
    lfs2_stat(&lfs2, "/", &info) => 0;
    assert(strcmp(info.name, "/") == 0);
    assert(info.type == LFS2_TYPE_DIR);
    lfs2_stat(&lfs2, "", &info) => 0;
    assert(strcmp(info.name, "/") == 0);
    assert(info.type == LFS2_TYPE_DIR);
    lfs2_stat(&lfs2, ".", &info) => 0;
    assert(strcmp(info.name, "/") == 0);
    assert(info.type == LFS2_TYPE_DIR);
    lfs2_stat(&lfs2, "..", &info) => 0;
    assert(strcmp(info.name, "/") == 0);
    assert(info.type == LFS2_TYPE_DIR);
    lfs2_stat(&lfs2, "//", &info) => 0;
    assert(strcmp(info.name, "/") == 0);
    assert(info.type == LFS2_TYPE_DIR);
    lfs2_stat(&lfs2, "./", &info) => 0;
    assert(strcmp(info.name, "/") == 0);
    assert(info.type == LFS2_TYPE_DIR);
    lfs2_unmount(&lfs2) => 0;
'''

# superblock conflict test
[cases.test_paths_superblock_conflict]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg) => 0;
    lfs2_mount(&lfs2, cfg) => 0;
    struct lfs2_info info;
    lfs2_stat(&lfs2, "littlefs", &info) => LFS2_ERR_NOENT;
    lfs2_remove(&lfs2, "littlefs") => LFS2_ERR_NOENT;

    lfs2_mkdir(&lfs2, "littlefs") => 0;
    lfs2_stat(&lfs2, "littlefs", &info) => 0;
    assert(strcmp(info.name, "littlefs") == 0);
    assert(info.type == LFS2_TYPE_DIR);
    lfs2_remove(&lfs2, "littlefs") => 0;
    lfs2_stat(&lfs2, "littlefs", &info) => LFS2_ERR_NOENT;
    lfs2_unmount(&lfs2) => 0;
'''

# max path test
[cases.test_paths_max]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg) => 0;
    lfs2_mount(&lfs2, cfg) => 0;
    lfs2_mkdir(&lfs2, "coffee") => 0;
    lfs2_mkdir(&lfs2, "coffee/hotcoffee") => 0;
    lfs2_mkdir(&lfs2, "coffee/warmcoffee") => 0;
    lfs2_mkdir(&lfs2, "coffee/coldcoffee") => 0;

    char path[1024];
    memset(path, 'w', LFS2_NAME_MAX+1);
    path[LFS2_NAME_MAX+1] = '\0';
    lfs2_mkdir(&lfs2, path) => LFS2_ERR_NAMETOOLONG;
    lfs2_file_t file;
    lfs2_file_open(&lfs2, &file, path, LFS2_O_WRONLY | LFS2_O_CREAT)
            => LFS2_ERR_NAMETOOLONG;

    memcpy(path, "coffee/", strlen("coffee/"));
    memset(path+strlen("coffee/"), 'w', LFS2_NAME_MAX+1);
    path[strlen("coffee/")+LFS2_NAME_MAX+1] = '\0';
    lfs2_mkdir(&lfs2, path) => LFS2_ERR_NAMETOOLONG;
    lfs2_file_open(&lfs2, &file, path, LFS2_O_WRONLY | LFS2_O_CREAT)
            => LFS2_ERR_NAMETOOLONG;
    lfs2_unmount(&lfs2) => 0;
'''

# really big path test
[cases.test_paths_really_big]
code = '''
    lfs2_t lfs2;
    lfs2_format(&lfs2, cfg) => 0;
    lfs2_mount(&lfs2, cfg) => 0;
    lfs2_mkdir(&lfs2, "coffee") => 0;
    lfs2_mkdir(&lfs2, "coffee/hotcoffee") => 0;
    lfs2_mkdir(&lfs2, "coffee/warmcoffee") => 0;
    lfs2_mkdir(&lfs2, "coffee/coldcoffee") => 0;

    char path[1024];
    memset(path, 'w', LFS2_NAME_MAX);
    path[LFS2_NAME_MAX] = '\0';
    lfs2_mkdir(&lfs2, path) => 0;
    lfs2_remove(&lfs2, path) => 0;
    lfs2_file_t file;
    lfs2_file_open(&lfs2, &file, path,
            LFS2_O_WRONLY | LFS2_O_CREAT) => 0;
    lfs2_file_close(&lfs2, &file) => 0;
    lfs2_remove(&lfs2, path) => 0;

    memcpy(path, "coffee/", strlen("coffee/"));
    memset(path+strlen("coffee/"), 'w', LFS2_NAME_MAX);
    path[strlen("coffee/")+LFS2_NAME_MAX] = '\0';
    lfs2_mkdir(&lfs2, path) => 0;
    lfs2_remove(&lfs2, path) => 0;
    lfs2_file_open(&lfs2, &file, path,
            LFS2_O_WRONLY | LFS2_O_CREAT) => 0;
    lfs2_file_close(&lfs2, &file) => 0;
    lfs2_remove(&lfs2, path) => 0;
    lfs2_unmount(&lfs2) => 0;
'''

