name: comment
on:
  workflow_run:
    workflows: [test]
    types: [completed]

jobs:
  comment:
    runs-on: ubuntu-22.04
    steps:
      # generated comment?
      - uses: dawidd6/action-download-artifact@v2
        continue-on-error: true
        with:
          workflow: ${{github.event.workflow_run.name}}
          run_id: ${{github.event.workflow_run.id}}
          name: comment
          path: comment
      - name: update-comment
        continue-on-error: true
        run: |
          ls comment
          for s in $(shopt -s nullglob ; echo comment/*.json)
          do
            export NUMBER="$(jq -er '.number' $s)"
            export BODY="$(jq -er '.body' $s)"

            # TODO check that commit is in pr number
            echo $NUMBER
            echo ${{github.event.workflow_run.head_sha}}
            echo $BODY

            # TODO upload comments
          done
